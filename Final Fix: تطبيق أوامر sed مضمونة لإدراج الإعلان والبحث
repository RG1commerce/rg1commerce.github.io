# اسم سير العمل (يظهر في قائمة Actions)
name: تحديث تلقائي وتثبيت الإعلان والبحث (الإصلاح 5 - التثبيت المضمون)

# متى يعمل هذا الإجراء؟
on:
  push:
    branches:
      - main
      
# تعريف المهمة
jobs:
  تعديل_ودفع_التحديثات:
    runs-on: ubuntu-latest
    
    # خطوات العمل
    steps:
      - name: سحب الكود من المستودع
        uses: actions/checkout@v4
      
      - name: تنفيذ أوامر التعديل المعقدة (الإصلاح 5)
        run: |
          # 1. تعريف كود الإعلان المثبت. (الرجاء استبدال "1234567890" برقم الوحدة الإعلانية الفعلي)
          AD_UNIT='\n<div id="top-fixed-ad-unit" style="position: sticky; top: 57px; z-index: 10001; width: 100%; background: #1f2937; padding: 5px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.2);">\n    <div class="adsense-unit" style="margin: 0 auto; min-height: 50px; border: none; padding: 0;">\n        <ins class="adsbygoogle"\n             style="display:block; text-align:center;"\n             data-ad-client="ca-pub-9228235223985409"\n             data-ad-slot="1234567890"\n             data-ad-format="auto"\n             data-full-width-responsive="true"></ins>\n        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>\n    </div>\n</div>\n'
          
          # 2. تعريف كود أيقونة البحث
          SEARCH_BUTTON='\n        <a href="#search-section" class="main-nav-link search-icon-btn">\n            <i class="fas fa-search"></i> <span data-key="menu_search">بحث</span>\n        </a>\n'
          
          # 3. الإدراج الحاسم للإعلان: قبل التعليق (النقطة المضمونة)
          sed -i '//i '"$AD_UNIT"'' Index.html
          
          # 4. الإدراج الحاسم للبحث: بعد رابط التسوق الذي يمثل آخر عنصر تنقل رئيسي
          sed -i '/shopping-section/a '"$SEARCH_BUTTON"'' Index.html
          
          # 5. خطوة تحقق: إضافة وسم تعليق واضح في نهاية الملف
          echo "" >> Index.html
          
      - name: حفظ التغييرات ودفعها تلقائيًا
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'آلي: تطبيق الإصلاح النهائي وإدراج الإعلان والبحث'
          token: ${{ secrets.GITHUB_TOKEN }}
